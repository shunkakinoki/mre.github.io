<!DOCTYPE html>
<html lang="en">
  <head>
    
    <style>
      html,body,div,form,fieldset,legend,label,h1,h2{margin:0;padding:0}html,body{height:100%}body{font-family:Georgia, Times, serif;font-size:120%;line-height:1.58;border-top:0.5em solid #c35}.container{display:flex;flex-direction:column;margin:0px auto;margin-top:10px}header{font-size:0.8em;text-align:center}.bio{width:210px;margin:auto;padding:16px}main{padding:20px;margin-bottom:50px;max-width:650px}figure a{border:none}figure a:hover{border:none}nav a,nav a:hover{border-bottom:none}main article{margin-bottom:44px}main img{max-width:100%}main video{max-width:100%}.homepage h1{font-size:130%}@media screen and (max-width: 640px){body{font-size:110%}}@media screen and (min-width: 800px){.container{flex-direction:row;justify-content:center;margin-top:70px}main{padding:0px 30px}.bio span:after{content:"Writes about Rust, low-level computing, and microwave clocks."}}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:400}.post-meta{font-style:italic;margin:0px;font-size:90%}.homepage .post-meta{font-size:80%}.post-links{list-style:none;padding:24px 0 0 0;margin-top:40px;border-top:solid 1px #555}code{background:#fafafa;border-radius:6px;display:inline-block;font-family:"Courier New", "Courier", monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,0.125)}blockquote{border-left:4px solid #9fd6fa;font-style:italic;margin:4px 10px;padding:3px 20px}pre{padding:10px;border-radius:6px;overflow-x:auto;box-shadow:0 1px 1px rgba(0,0,0,0.125)}h1{font-size:1.87em;margin-bottom:8px}h2{font-size:1.2em}h3{margin-top:0px;font-style:italic}::selection{background:black;color:white}a{color:#c35;text-decoration:none;border-bottom:1px dashed #c35}a:hover{border-bottom:2px solid #c35}header nav ul{display:inline-block;padding-left:0px;margin-top:0}header nav li{list-style:none;display:inline}.icon{height:24px;width:24px;opacity:0.4;float:left;margin:5px;background-repeat:no-repeat}.icon:hover{opacity:1;transition:opacity 200ms ease-in}.button{background-color:#c35;padding:10px;color:white}figure{font-size:0.9em;font-style:italic;margin:40px 0 40px;padding:0;text-align:center;text-indent:0}figure img{width:100%}figcaption{margin-top:10px}.comments{list-style:none;display:inline}#teaser{background:#c35;color:#f5b2c8}#teaser a,footer a{color:white;border-bottom:2px solid #c35}#teaser a::after{content:"\a0¬ª"}footer{background:#234;color:#b9b9b9}#teaser,footer{display:flex;justify-content:center}#teaser .body,footer .body{max-width:800px;margin:40px auto;padding:20px}.email{background-color:white}.submit{background-color:#b9b9b9}footer .field{padding:10px;font-size:0.8em;border:none}.autocomplete{position:relative;display:inline-block}.autocomplete input{border:1px solid #ddd;padding:10px 20px;border-radius:20px;width:150px;font-size:0.9em;box-shadow:0 1px 0px rgba(255,255,255,0.25)}input[type="submit"]{cursor:pointer}input:focus::placeholder{color:transparent}.autocomplete-items{position:absolute;left:0;top:38px;font-size:0.9em;line-height:1.5;width:100%}.autocomplete-items div{padding:10px;cursor:pointer;background-color:white;border:1px solid #ddd}.autocomplete-items div:hover,.autocomplete-active{background-color:#c35 !important;color:white}@media not screen and (max-width: 800px){.searchicon{display:none}}@media screen and (max-width: 800px){#searchbox{display:none}#searchbox:target{display:block}.autocomplete{width:100%;font-size:1.1em}.autocomplete input{width:calc(100% - 100px);margin:20px 10px}.autocomplete-items{top:58px}}.info{padding:20px;margin:30px 0;background-color:lightyellow;border:4px solid peachpuff;position:relative;border-radius:6px}.logo_font{position:relative;width:175px;height:34px;margin:0 auto}.logo_font svg{position:absolute;top:0;left:0}@media (prefers-color-scheme: light){.logo_font_dark{display:none}}@media (prefers-color-scheme: dark){.logo_font_light{display:none}}@media (prefers-color-scheme: dark){body{background:#234;color:white;border-top:0.5em solid #ff1c76}.bio,.post-meta{color:#b9b9b9}.post-links{border-top:solid 1px white}a{color:#ff1c76;border-bottom:1px dashed #ff1c76}a:hover{border-bottom:2px solid #ff1c76}.icon{filter:brightness(0) invert(1)}main img{background-color:white;border-radius:6px}code{background-color:#111}pre{background-color:#fff;-webkit-filter:invert(100%);filter:invert(100%)}.info{background:#141f2b;border-color:#555}.autocomplete input,.autocomplete-items div{border:0;background:#141f2b;color:white}footer{background:#141f2b}}

    </style>
<title>A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly | Matthias Endler</title>
<link rel="canonical" href="https://endler.dev/2019/tinysearch/">

<meta property="og:title" content="A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly | Matthias Endler" />
<meta property="og:type" content="website" />
<meta property="og:description" content="
  I wrote a basic search module‚Ä¶" />
<meta property="og:url" content="https://endler.dev/2019/tinysearch/" />
<meta property="og:image" content="https://endler.dev/default.png" />

<meta name="twitter:title" content="A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly">
<meta name="twitter:description" content="
  I wrote a basic search module‚Ä¶">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://endler.dev/default.png">
    <link rel="canonical" href="https://endler.dev/2019/tinysearch/" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x32.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x16.png?v=m2llJQPQq8"
    />
    <link
      rel="mask-icon"
      href="/safari-pinned-tab.svg?v=m2llJQPQq8"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="author" content="Matthias Endler" />
    <meta
      name="description"
      content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and Backend development. Rust, Go"
    />
  </head>

  <body>
    <div class="container">
      <header>
        



<a href="/" aria-label="Go back to homepage">
  <div style="width: 110px; margin: auto;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456 456"><defs/><g letter-spacing="0" transform="translate(-167)" word-spacing="0"><circle cx="395" cy="228" r="220" fill="#fff" stroke="#000" stroke-width="16"/><path fill="#856800" fill-rule="evenodd" d="M468 266l-70 37-77-37z"/><path fill="#ffcb15" fill-rule="evenodd" d="M468 266l-70 31-77-31z"/><path d="M360 208a22 21 85 00-2 0 22 21 85 00-19 24 22 21 85 0023 19 22 21 85 0019-23 22 21 85 00-7-14 5 6 0 012 4 5 6 0 01-6 7 5 6 0 01-5-7 5 6 0 016-6 5 6 0 013 1 22 21 85 00-14-5zm71 1a22 21 85 00-2 0 22 21 85 00-19 23 22 21 85 0022 20 22 21 85 0019-24 22 21 85 00-20-19zm10 4a5 6 0 015 6 5 6 0 01-5 6 5 6 0 01-5-6 5 6 0 015-6z"/></g><path fill-rule="evenodd" d="M262 58c-4 9-12 19-19 24 1-8 2-16 1-22-4 8-12 18-20 24 2-7 2-15 1-21-7 13-15 24-29 28-70 20-131 113-152 213 11 28 29 53 51 73 8-158 45-267 112-208 10 9 16 13 20 13 5 0 10-4 21-13 67-59 105 50 112 208 22-20 40-45 51-73-20-95-77-184-144-209l-10-4c4-8 7-23 5-33z"/></svg>
  </div>
  <div class="logo_font">
    <div class="logo_font_dark">
    <svg xmlns="http://www.w3.org/2000/svg" class="logo_font_dark" viewBox="0 0 786.1 139.2"><defs/><path fill="#fff" d="M734.2.1v139h12V73.3l7.3-.3 19.2 66.2 13.4-.1L765 69.4c7.8-4.8 14.7-12 14.4-35.5C779.1 10.2 764.9.2 749.2.1zm-200 .5l-11.4.1v138h11.4v-101l28.3 101v.4h11.3V1.1h-11.2v51.8l-.1-.1V102L534.2 1V.8zm116 0v138h31.6v-10.7l-20.2.1V0h-11.4zm-171 .1v138h31.7V128h-20.2V72.3h18.8V61.7h-18.8V11.1h20.2V.4h-31.7zm109 0v138h13.9c14.8 0 24.7-7.5 29.5-22.5 2.8-8.9 4.2-24.4 4.2-46.7 0-22.2-1.4-37.8-4.2-46.6C626.8 7.9 616.9.4 602.1.4h-13.9zm103 0v138h31.7V128h-20.4V72.3h19V61.7h-19V11.1h20.3V.4h-31.6zm54 9.8c16.5 0 20.6 7.9 20.6 23.3 0 15.5-1 28-20.6 28zm-146 .9h1.2c10.5 0 17.4 6.2 20.6 18.5a176 176 0 013.1 40c0 19.2-1 32.5-3.1 39.9-3.2 12.3-10 18.5-20.6 18.5h-1.2v-117z" color="#000" style="font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;text-orientation:mixed;white-space:normal;shape-padding:0;isolation:auto;mix-blend-mode:normal"/><path fill="#9f9f9f" d="M406.2.1a23.8 23.8 0 00-11.3 3.3 22.4 22.4 0 00-9 12.2 42 42 0 00.7 30.2 68.6 68.6 0 0011.7 18.4 2360 2360 0 019.4 11c10.6 12.3 14.7 23 13.3 34.8-1.1 8.5-4.2 14-9.7 17.3-4.1 2.4-10.3 2-15.3.2a44.7 44.7 0 01-10.9-9l-5.3 7.4a15 15 0 002.5 3.6c2.8 3.2 8 6.9 11.8 8.2l.2.3a52.7 52.7 0 0020 0c9-3.5 14.6-11.7 16.2-24 1-6.6 1-11 0-16.6-1.9-12.4-5.8-19.5-18.8-34.7-13.5-15.5-16.9-21.1-18-29.5-1.3-9.7 1.9-18 7.9-21.4 4.4-2.3 8.5-1.3 12.9.7a28 28 0 014.4 3.2l1.6 1.3c.6 0 3.9-8 4.4-8.8A23.8 23.8 0 00406.2.1zm-302 .2l-20.9 138h11.4l6-45.8H120l6 45.8h11.4L116.5.3zm78 0h-39.4v10.8h14.8v128H169v-128h28.1v128h11.4v-128h14.9V.3zm46.3 0v138H240V72h28.4v66.4h11.2V.4L268.3.3v61.5h-28.4V.3zm66.1 0v138H306V.3zm47.4 0l-21 138h11.4l5.9-45.8h19.4l5.9 45.9H375L354.2.4H342zM0 .7v138h11.4v-117c6.6 12.7 13.8 26 19.7 36.8l5.7 10 5.7-10 19.7-36.6v117h11.2V.9H62.2L40.7 40.7l-4 7.4c-9-17-17.3-32-25.4-47.2L0 .8zm110 18.7l8.5 64.3h-17zm238 0l8.4 64.4h-16.9l8.5-64.3z"/></svg>
    </div>
    <div class="logo_font_light">
    <svg xmlns="http://www.w3.org/2000/svg" class="logo_font_light" viewBox="0 0 786.1 139.2"><defs/><path fill="#030303" style="font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;text-orientation:mixed;white-space:normal;shape-padding:0;isolation:auto;mix-blend-mode:normal" d="M734.2.1v139h12V73.3l7.3-.3 19.2 66.2 13.4-.1L765 69.4c7.8-4.8 14.7-12 14.4-35.5C779.1 10.2 764.9.2 749.2.1zm-200 .5l-11.4.1v138h11.4v-101l28.3 101v.4h11.3V1.1h-11.2v51.8l-.1-.1V102L534.2 1V.8zm116 0v138h31.6v-10.7l-20.2.1V0h-11.4zm-171 .1v138h31.7V128h-20.2V72.3h18.8V61.7h-18.8V11.1h20.2V.4h-31.7zm109 0v138h13.9c14.8 0 24.7-7.5 29.5-22.5 2.8-8.9 4.2-24.4 4.2-46.7 0-22.2-1.4-37.8-4.2-46.6C626.8 7.9 616.9.4 602.1.4h-13.9zm103 0v138h31.7V128h-20.4V72.3h19V61.7h-19V11.1h20.3V.4h-31.6zm54 9.8c16.5 0 20.6 7.9 20.6 23.3 0 15.5-1 28-20.6 28zm-146 .9h1.2c10.5 0 17.4 6.2 20.6 18.5a176 176 0 013.1 40c0 19.2-1 32.5-3.1 39.9-3.2 12.3-10 18.5-20.6 18.5h-1.2v-117z" color="#000"/><path fill="#9f9f9f" d="M406.2.1a23.8 23.8 0 00-11.3 3.3 22.4 22.4 0 00-9 12.2 42 42 0 00.7 30.2 68.6 68.6 0 0011.7 18.4 2360 2360 0 019.4 11c10.6 12.3 14.7 23 13.3 34.8-1.1 8.5-4.2 14-9.7 17.3-4.1 2.4-10.3 2-15.3.2a44.7 44.7 0 01-10.9-9l-5.3 7.4a15 15 0 002.5 3.6c2.8 3.2 8 6.9 11.8 8.2l.2.3a52.7 52.7 0 0020 0c9-3.5 14.6-11.7 16.2-24 1-6.6 1-11 0-16.6-1.9-12.4-5.8-19.5-18.8-34.7-13.5-15.5-16.9-21.1-18-29.5-1.3-9.7 1.9-18 7.9-21.4 4.4-2.3 8.5-1.3 12.9.7a28 28 0 014.4 3.2l1.6 1.3c.6 0 3.9-8 4.4-8.8A23.8 23.8 0 00406.2.1zm-302 .2l-20.9 138h11.4l6-45.8H120l6 45.8h11.4L116.5.3zm78 0h-39.4v10.8h14.8v128H169v-128h28.1v128h11.4v-128h14.9V.3zm46.3 0v138H240V72h28.4v66.4h11.2V.4L268.3.3v61.5h-28.4V.3zm66.1 0v138H306V.3zm47.4 0l-21 138h11.4l5.9-45.8h19.4l5.9 45.9H375L354.2.4H342zM0 .7v138h11.4v-117c6.6 12.7 13.8 26 19.7 36.8l5.7 10 5.7-10 19.7-36.6v117h11.2V.9H62.2L40.7 40.7l-4 7.4c-9-17-17.3-32-25.4-47.2L0 .8zm110 18.7l8.5 64.3h-17zm238 0l8.4 64.4h-16.9l8.5-64.3z"/></svg>
    </div>
  </div>
</a>

        <p class="bio">
          <span>
            Backend engineer at trivago, open-source maintainer, speaker.
          </span>
          <a href="/about">About me.</a>
        </p>
        





<nav>
    <ul>
        <li>
            <a class="icon" href="/" title="Go to homepage" aria-label="Go to homepage">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 61 58'><path stroke='#fff' stroke-linecap='square' stroke-width='.52916' d='M7 21v36h16V38h15v19h15V21z'/><path d='M61 26H0l15-13L30 0l15 13z'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://github.com/mre" title="My Github profile" aria-label="My Github profile">
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 578.3 578.3'><path d='M533 160c1-26-5-53-10-79-1-9-5-18-8-27-2-6-10-10-16-9l-12 3c-39 13-76 32-111 54-5 3-11 4-17 3l-41-5c-33-1-67 0-100 6-5 1-11 0-15-3-38-24-77-46-122-57-7-2-14-1-15 1l-3 6c-5 16-10 33-13 51-4 20-7 42-5 62 1 13-3 21-10 30-24 31-34 66-35 104-1 33 4 65 14 97 15 48 45 84 90 108 36 19 76 27 117 28h111c37 1 73-3 109-14 35-12 66-30 90-60 34-42 45-92 47-145 2-40-6-78-30-111a65 65 0 01-15-43zm-71 310c-16 13-35 20-55 25-39 9-79 11-119 10-39 1-78-1-116-10-28-7-54-18-72-42-29-39-36-112 11-152 12-11 26-17 41-18l53-3 133 3c20 0 40-5 60-4 18 2 38 5 54 12 28 12 42 37 47 66 7 43-2 83-37 113z'/><ellipse cx='390' cy='385.6' rx='42.1' ry='56.3'/><ellipse cx='189' cy='385.6' rx='42.1' ry='56.3'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://twitter.com/matthiasendler" title="My Twitter profile"
                aria-label="My Twitter profile">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 612 612'><path fill='#010002' d='M612 116c-23 10-47 17-72 20 26-15 46-40 55-69-24 14-51 24-80 30a125 125 0 0 0-217 86c0 10 1 19 3 29-104-6-196-56-258-132a125 125 0 0 0 39 168c-21-1-40-6-57-16v2c0 61 43 111 100 123a127 127 0 0 1-56 2c16 50 62 86 117 87A252 252 0 0 1 0 498a355 355 0 0 0 550-301l-1-16c25-17 46-40 63-65z'/></svg> 
            </a>
        </li>
        <li>
            <a class="icon" href="https://feedly.com/i/subscription/feed/https%3A%2F%2Fendler.dev%2Frss.xml" title="My RSS feed"
                aria-label="My RSS feed"><svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 1280 1280'><path d='M264 224l-1 79v79h8a660 660 0 0 1 438 174 665 665 0 0 1 218 492h156l1-26a820 820 0 0 0-715-792c-37-5-103-9-105-6z'/><path d='M263 504l-1 78 1 79 14 2a383 383 0 0 1 369 368l1 17h158v-19a536 536 0 0 0-98-293 546 546 0 0 0-444-232zM353 830a110 110 0 0 0-77 160 110 110 0 1 0 188-114c-5-7-23-25-30-29-25-16-54-22-81-17z'/></svg></a>
        </li>
        <li>
            <a class="searchicon icon" href="#searchbox" title="Search"
                aria-label="Search through articles">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90.1 90.1"><defs/><path d="M71.8 62.6a39.6 39.6 0 10-9.2 9.2L79 88.2a6.5 6.5 0 009.2-9.2zM13 39.6a26.5 26.5 0 1126.5 26.5 26.5 26.5 0 01-26.5-26.5z"/></svg>
            </a>
        </li>
    </ul>
</nav> 
<script defer type="module">async function lazyLoad(){await init("/tinysearch_engine_bg.wasm")}var loaded=!1;function autocomplete(e){var t;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),t>=e.length&&(t=0),t<0&&(t=e.length-1),e[t].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("click",(function(e){loaded||(lazyLoad(),loaded=!0)})),e.addEventListener("input",(function(e){var n,o,i,c=this.value;if(a(),!c)return!1;t=-1,(n=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(n);let r=search(c,3);for(i=0;i<r.length;i++){let e=r[i];(o=document.createElement("DIV")).innerHTML=e[0],o.addEventListener("click",(function(t){window.location.href=`${e[1]}?q=${encodeURIComponent(c)}`})),n.appendChild(o)}})),e.addEventListener("keydown",(function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(t++,n(a)):38==e.keyCode?(t--,n(a)):13==e.keyCode&&(e.preventDefault(),t>-1&&a&&a[t].click())})),document.addEventListener("click",(function(e){a(e.target)}))}let wasm;autocomplete(document.getElementById("tinysearch"));let WASM_VECTOR_LEN=0,cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const n=cachedTextEncoder.encode(e);return t.set(n),{read:e.length,written:n.length}};let cachegetUint8Memory=null;function getUint8Memory(){return null!==cachegetUint8Memory&&cachegetUint8Memory.buffer===wasm.memory.buffer||(cachegetUint8Memory=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory}function passStringToWasm(e){let t=e.length,n=wasm.__wbindgen_malloc(t);const a=getUint8Memory();let o=0;for(;o<t;o++){const t=e.charCodeAt(o);if(t>127)break;a[n+o]=t}if(o!==t){0!==o&&(e=e.slice(o)),n=wasm.__wbindgen_realloc(n,t,t=o+3*e.length);const a=getUint8Memory().subarray(n+o,n+t);o+=encodeString(e,a).written}return WASM_VECTOR_LEN=o,n}const heap=new Array(32);function getObject(e){return heap[e]}heap.fill(void 0),heap.push(void 0,null,!0,!1);let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}export function search(e,t){return takeObject(wasm.search(passStringToWasm(e),WASM_VECTOR_LEN,t))}let cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function getStringFromWasm(e,t){return cachedTextDecoder.decode(getUint8Memory().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;return heap_next=heap[t],heap[t]=e,t}function init(e){let t;void 0===e&&(e=import.meta.url.replace(/\.js$/,"_bg.wasm"));const n={wbg:{}};if(n.wbg.__wbindgen_json_parse=function(e,t){return addHeapObject(JSON.parse(getStringFromWasm(e,t)))},"function"==typeof URL&&e instanceof URL||"string"==typeof e||"function"==typeof Request&&e instanceof Request){const a=fetch(e);t="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,n).catch(e=>a.then(t=>{if("application/wasm"!=t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),t.arrayBuffer();throw e}).then(e=>WebAssembly.instantiate(e,n))):a.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))}else t=WebAssembly.instantiate(e,n).then(t=>t instanceof WebAssembly.Instance?{instance:t,module:e}:t);return t.then(({instance:e,module:t})=>(wasm=e.exports,init.__wbindgen_wasm_module=t,wasm))}export default init;</script>
<form id="searchbox" autocomplete="off">
    <div class="autocomplete">
        <input id="tinysearch" type="text" aria-label="Search through articles" placeholder="&#x1F50D; Search">
        </label>
    </div>
</form>
      </header>

      <main>
        
<article>
  <p class='post-meta'>Published on 




17th of October, 2019
</p>
  <h1>A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly</h1>
  
  <div class="info">
  I wrote a basic search module that you can add to a static website.
It's very lightweight (50kB-100kB gzipped) and should work with Hugo, Zola, and
Jekyll. Only searching for entire words is supported. Try the search box on the
left for a demo. <a href="https://github.com/mre/tinysearch">The code is on Github</a>.
</div>
<p>Static site generators are magical. They combine the best of both worlds:
dynamic content without sacrificing performance.</p>
<p>Over the years, this blog has been running on <a href="https://github.com/mre/mre.github.io.v1">Jekyll</a>, <a href="https://github.com/mre/mre.github.io.v2">Cobalt</a>, and, lately,
<a href="https://www.getzola.org/">Zola</a>.</p>
<p>One thing I always disliked, however, was the fact that static websites don't
come with &quot;static&quot; search engines, too. Instead, people resort to <a href="https://cse.google.com/cse/">custom Google
searches</a>, external search engines like <a href="https://www.algolia.com/">Algolia</a>, or pure
JavaScript-based solutions like <a href="https://lunrjs.com/">lunr.js</a> or <a href="http://elasticlunr.com/">elasticlunr</a>.</p>
<p>All of these work fine for most sites, but it never felt like the final answer.</p>
<p>I didn't want to add yet another dependency on Google; neither did I want to use
a stand-alone web-backend like Algolia, which adds latency and is proprietary.</p>
<p>On the other side, I'm not a huge fan of JavaScript-heavy websites. For example,
just the search indices that lunr creates can be <a href="https://github.com/olivernn/lunr.js/issues/268#issuecomment-304490937">multiple megabytes
in size</a>.
That feels lavish - even by today's bandwidth standards. On top of that,
<a href="https://v8.dev/blog/cost-of-javascript-2019">parsing JavaScript is still
time-consuming</a>.</p>
<p>I wanted some simple, lean, and self-contained search, that could be deployed
next to my other static content.</p>
<p>As a consequence, I refrained from adding search functionality to my blog at
all. That's unfortunate because, with a growing number of articles, it gets
harder and harder to find relevant content.</p>
<h2 id="the-idea">The Idea</h2>
<p>Many years ago, in 2013, I read <a href="https://www.stavros.io/posts/bloom-filter-search-engine/">&quot;Writing a full-text search engine using Bloom
filters&quot;</a> ‚Äî and it was a revelation.</p>
<p>The idea was simple: Let's run all articles through a generator that creates a
tiny, self-contained search index using this magical data structure called a
‚ú®<em>Bloom Filter</em> ‚ú®.</p>
<h2 id="what-s-a-bloom-filter">What's a Bloom Filter?</h2>
<p>Roughly speaking, a <a href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom filter</a> is a space-efficient way to
check if an element is in a set.</p>
<p>The trick is that it doesn't store the elements themselves; it just knows with
some confidence that they were stored before. In our case, it can say with a
certain <em>error rate</em> that a word is in an article.</p>
<figure>
        <img src=".&#x2F;bloomfilter.svg"  />
    <figcaption>
        A Bloom filter stores a
'fingerprint' (a number of hash values) of all inputs values instead of the raw
input. The result is a low-memory-footprint data structure. This is an example
of 'hello' as an input.
    </figcaption>
</figure>
<p>Here's the Python code from the original article that generates the Bloom
filters for each post (courtesy of <a href="https://www.stavros.io">Stavros
Korokithakis</a>):</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">filters </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">{}
</span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">name</span><span style="color:#61676ccc;">, </span><span style="color:#61676c;">words </span><span style="color:#fa6e32;">in </span><span style="color:#61676c;">split_posts</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">items</span><span style="color:#61676c;">():
  filters[name] </span><span style="color:#ed9366;">= </span><span style="color:#f29718;">BloomFilter</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">capacity</span><span style="color:#ed9366;">=</span><span style="color:#f07171;">len</span><span style="color:#61676c;">(words)</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">error_rate</span><span style="color:#ed9366;">=</span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">.</span><span style="color:#ff8f40;">1</span><span style="color:#61676c;">)
  </span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">word </span><span style="color:#fa6e32;">in </span><span style="color:#61676c;">words:
    filters[name]</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">add</span><span style="color:#61676c;">(word)
</span></pre>
<p>The memory footprint is extremely small, thanks to <code>error_rate</code>, which allows
for a negligible number of false positives.</p>
<p>I immediately knew that I wanted something like this for my homepage. My idea
was to directly ship the Bloom filters and the search engine to the browser. I
could finally have a small, static search without the need for a backend!</p>
<h2 id="headaches">Headaches</h2>
<p>The disillusionment came quickly.</p>
<p>I had no idea how to bundle and minimize the generated Bloom filters, let alone
run them on clients. The original article briefly touches on this:</p>
<blockquote>
<p>You need to implement a Bloom filter algorithm on the client-side. This will
probably not be much longer than the inverted index search algorithm, but it‚Äôs
still probably a bit more complicated.</p>
</blockquote>
<p>I didn't feel confident enough in my JavaScript skills to pull this off. Back in
2013, NPM was a mere three years old, and WebPack just turned one, so I also
didn't know where to look for existing solutions.</p>
<p>Unsure what to do next, my idea remained a pipe dream.</p>
<h2 id="a-new-hope">A New Hope</h2>
<p>Five years later, in 2018, the web had become a different place. Bundlers were
ubiquitous, and the Node ecosystem was flourishing. One thing, in particular,
revived my dreams about the tiny static search engine: [1embly].</p>
<blockquote>
<p>WebAssembly (abbreviated Wasm) is a binary instruction format for a
stack-based virtual machine. Wasm is designed as a portable target for
compilation of high-level languages like C/C++/Rust, enabling deployment on
the web for client and server applications. [<a href="https://webassembly.org/">source</a>]</p>
</blockquote>
<p>This meant that I could use a language that I was familiar with to write the
client-side code ‚Äî Rust! üéâ</p>
<p>My journey started with a <a href="https://github.com/mre/tinysearch/commit/82c1d36835348718f04c9ca0dd2c1ebf8b19a312">prototype back in January
2018</a>.
It was just a direct port of the Python version from above:</p>
<pre style="background-color:#fafafa;">
<span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> filters </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">HashMap</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new()</span><span style="color:#61676ccc;">;
</span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">(name</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> words) </span><span style="color:#ed9366;">in</span><span style="color:#61676c;"> articles {
  </span><span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> filter </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">BloomFilter</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">with_rate(</span><span style="color:#ff8f40;">0.1</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> words</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">len</span><span style="color:#61676c;">() </span><span style="color:#ed9366;">as </span><span style="color:#fa6e32;">u32</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="color:#fa6e32;">for</span><span style="color:#61676c;"> word </span><span style="color:#ed9366;">in</span><span style="color:#61676c;"> words {
    filter</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">insert</span><span style="color:#61676c;">(</span><span style="color:#ed9366;">&amp;</span><span style="color:#61676c;">word)</span><span style="color:#61676ccc;">;
  </span><span style="color:#61676c;">}
  filters</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">insert</span><span style="color:#61676c;">(name</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> filter)</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}
</span></pre>
<p>While I managed to create the Bloom filters for every article, I <em>still</em> had no
clue how I should package that up for the web... until <a href="https://github.com/rustwasm/wasm-pack/commit/125431f97eecb6f3ca5122f8b345ba5b7eee94c7">wasm-pack came along in
February
2018</a>.</p>
<h2 id="whoops-i-shipped-some-rust-code-to-your-browser">Whoops! I Shipped Some Rust Code To Your Browser.</h2>
<p>Now I had all the pieces of the puzzle:</p>
<ul>
<li>Rust - A language I am comfortable with</li>
<li><a href="https://github.com/rustwasm/wasm-pack">wasm-pack</a> - A bundler for WebAssembly modules</li>
<li>A working prototype that served as a proof-of-concept</li>
</ul>
<p>The search box you see at the top of this page is the outcome. It fully runs on Rust using
WebAssembly (a.k.a the <a href="https://twitter.com/timClicks/status/1181822319620063237">RAW stack</a>). Try it now if you like.</p>
<p>There were quite a few obstacles along the way.</p>
<h2 id="bloom-filter-crates">Bloom Filter Crates</h2>
<p>I looked into a few Rust libraries (crates) that implement Bloom filters.</p>
<p>First, I tried jedisct1's
<a href="https://github.com/jedisct1/rust-bloom-filter">rust-bloom-filter</a>, but the types
didn't implement
<a href="https://docs.serde.rs/serde/trait.Serialize.html">Serialize</a>/<a href="https://docs.serde.rs/serde/trait.Deserialize.html">Deserialize</a>.
This meant that I could not store my generated Bloom filters inside the binary and load
them from the client-side.</p>
<p>After trying a few others, I found the
<a href="https://github.com/seiflotfy/rust-cuckoofilter">cuckoofilter</a> crate, which
supported serialization. The behavior is similar to Bloom filters, but if you're
interested in the differences, you can look at <a href="https://brilliant.org/wiki/cuckoo-filter/">this
summary</a>.</p>
<p>Here's how to use it:</p>
<pre style="background-color:#fafafa;">
<span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> cf </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">cuckoofilter</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new()</span><span style="color:#61676ccc;">;

</span><span style="font-style:italic;color:#abb0b6;">// Add data to the filter
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> value</span><span style="color:#61676ccc;">: </span><span style="color:#ed9366;">&amp;</span><span style="color:#fa6e32;">str </span><span style="color:#ed9366;">= </span><span style="color:#86b300;">&quot;hello world&quot;</span><span style="color:#61676ccc;">;
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> success </span><span style="color:#ed9366;">=</span><span style="color:#61676c;"> cf</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">add</span><span style="color:#61676c;">(value)</span><span style="color:#ed9366;">?</span><span style="color:#61676ccc;">;

</span><span style="font-style:italic;color:#abb0b6;">// Lookup if data was added before
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> success </span><span style="color:#ed9366;">=</span><span style="color:#61676c;"> cf</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">contains</span><span style="color:#61676c;">(value)</span><span style="color:#61676ccc;">;
</span><span style="font-style:italic;color:#abb0b6;">// success ==&gt; true
</span></pre>
<p>Let's check the output size when bundling the filters for ten articles on my blog using cuckoo filters:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">~/C/p/tinysearch ‚ùØ‚ùØ‚ùØ l storage
Permissions Size User    Date Modified Name
.rw-r--r--   44k mendler 24 Mar 15:42  storage
</span></pre>
<p><strong>44kB</strong> doesn't sound too shabby, but these are just the cuckoo filters for ten
articles, serialized as a Rust binary. On top of that, we have to add the search
functionality and the helper code. In total, the client-side code weighed in at
<strong>216kB</strong> using vanilla wasm-pack. Too much.</p>
<h2 id="trimming-binary-size">Trimming Binary Size</h2>
<p>After the sobering first result of 216kB for our initial prototype, we have a
few options to bring the binary size down.</p>
<p>The first is following <a href="https://github.com/johnthagen">johnthagen's</a> advice on
<a href="https://github.com/johnthagen/min-sized-rust">minimizing Rust binary size</a>.</p>
<p>By setting a few options in our <code>Cargo.toml</code>, we can shave off quite a few bytes:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">&quot;opt-level = &#39;z&#39;&quot; =&gt; 249665 bytes
&quot;lto = true&quot;      =&gt; 202516 bytes
&quot;opt-level = &#39;s&#39;&quot; =&gt; 195950 bytes
</span></pre>
<p>Setting <code>opt-level</code> to <code>s</code> means we trade size for speed,
but we're preliminarily interested in minimal size anyway. After all, a small download size also improves performance.</p>
<p>Next, we can try <a href="https://github.com/rustwasm/wee_alloc">wee_alloc</a>, an alternative Rust allocator
producing a small <code>.wasm</code> code size.</p>
<blockquote>
<p>It is geared towards code that makes a handful of initial dynamically sized allocations, and then performs its heavy lifting without any further allocations. This scenario requires some allocator to exist, but we are more than happy to trade allocation performance for small code size.</p>
</blockquote>
<p>Exactly what we want. Let's try!</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">&quot;wee_alloc and nightly&quot; =&gt; 187560 bytes
</span></pre>
<p>We shaved off another 4% from our binary.</p>
<p>Out of curiosity, I tried to set <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#codegen-units">codegen-units</a> to 1, meaning we only use a single thread for code generation. Surprisingly, this resulted in a slightly smaller binary size.</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">&quot;codegen-units = 1&quot; =&gt; 183294 bytes
</span></pre>
<p>Then I got word of a Wasm optimizer called <code>binaryen</code>.
On macOS, it's available through homebrew:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">brew install binaryen
</span></pre>
<p>It ships a binary called <code>wasm-opt</code> and that shaved off another 15%:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">&quot;wasm-opt -Oz&quot; =&gt; 154413 bytes
</span></pre>
<p>Then I removed web-sys as we don't have to bind to the DOM: 152858 bytes.</p>
<p>There's a tool called <a href="https://github.com/rustwasm/twiggy">twiggy</a> to profile the code size of Wasm binaries.
It printed the following output:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">twiggy top -n 20 pkg/tinysearch_bg.wasm
 Shallow Bytes ‚îÇ Shallow % ‚îÇ Item
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         79256 ‚îä    44.37% ‚îä data[0]
         13886 ‚îä     7.77% ‚îä &quot;function names&quot; subsection
          7289 ‚îä     4.08% ‚îä data[1]
          6888 ‚îä     3.86% ‚îä core::fmt::float::float_to_decimal_common_shortest::hdd201d50dffd0509
          6080 ‚îä     3.40% ‚îä core::fmt::float::float_to_decimal_common_exact::hcb5f56a54ebe7361
          5972 ‚îä     3.34% ‚îä std::sync::once::Once::call_once::{{closure}}::ha520deb2caa7e231
          5869 ‚îä     3.29% ‚îä search
</span></pre>
<p>From what I can tell, the biggest chunk of our binary is occupied by the raw data section for our articles.
Next up, we got the function headers and some float to decimal helper functions, that most likely come from deserialization.</p>
<p>Finally, I tried <a href="https://github.com/rustwasm/wasm-snip">wasm-snip</a>, which replaces a WebAssembly function's body with an <code>unreachable</code> like so, but it didn't reduce code size:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">wasm-snip --snip-rust-fmt-code --snip-rust-panicking-code -o pkg/tinysearch_bg_snip.wasm pkg/tinysearch_bg_opt.wasm
</span></pre>
<p>After tweaking with the parameters of the cuckoo filters a bit and removing
<a href="https://en.wikipedia.org/wiki/Stop_words">stop words</a> from the articles, I
arrived at <strong>121kB</strong> (51kB gzipped) ‚Äî not bad considering the average image size on the web is <a href="https://httparchive.org/reports/state-of-images#bytesImg">around 900kB</a>.
On top of that, the search functionality only gets loaded when a user clicks into the search field.</p>
<h2 id="frontend-and-glue-code">Frontend and Glue Code</h2>
<p>wasm-pack will auto-generate the JavaScript code to talk to Wasm.</p>
<p>For the search UI, I customized a few JavaScript and CSS bits from
<a href="https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_autocomplete">w3schools</a>.
It even has keyboard support!
Now when a user enters a search query, we go through the cuckoo filter of each
article and try to match the words. The results are scored by the number of
hits. Thanks to my dear colleague <a href="https://github.com/jorgelbg/">Jorge Luis Betancourt</a> for adding that part.</p>
<p><img src="./anim-opt.gif" alt="Video of the search functionality" /></p>
<p>(Fun fact: this animation is about the same size as the Wasm search itself.)</p>
<p>Only whole words are matched. I would love to add prefix-search, but the
binary became too big when I tried.</p>
<h2 id="usage">Usage</h2>
<p>The standalone binary to create the Wasm file is called <code>tinysearch</code>.
It expects a single path to a JSON file as an input:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">tinysearch path/to/corpus.json
</span></pre>
<p>This <code>corpus.json</code> contains the text you would like to index. The format is pretty straightforward:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">[
  {
    </span><span style="color:#55b4d4;">&quot;title&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;Article 1&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#55b4d4;">&quot;url&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;https://example.com/article1&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#55b4d4;">&quot;body&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;This is the body of article 1.&quot;
  </span><span style="color:#61676c;">}</span><span style="color:#61676ccc;">,
  </span><span style="color:#61676c;">{
    </span><span style="color:#55b4d4;">&quot;title&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;Article 2&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#55b4d4;">&quot;url&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;https://example.com/article2&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#55b4d4;">&quot;body&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;This is the body of article 2.&quot;
  </span><span style="color:#61676c;">}
]
</span></pre>
<p>You can generate this JSON file with any static site generator.
<a href="https://github.com/mre/mre.github.io/tree/1c731717b48afb584e54ca4dd5fd649f9b74e51c/templates">Here's my version for Zola</a>:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">{% </span><span style="color:#f29718;">set section </span><span style="color:#ed9366;">= </span><span style="color:#f29718;">get_section</span><span style="color:#61676c;">(</span><span style="color:#f29718;">path</span><span style="color:#ed9366;">=</span><span style="color:#86b300;">&quot;_index.md&quot;</span><span style="color:#61676c;">) %}

[
  {%</span><span style="color:#ed9366;">- </span><span style="color:#fa6e32;">for </span><span style="color:#f29718;">post in section</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">pages </span><span style="color:#ed9366;">-</span><span style="color:#61676c;">%}
    {% </span><span style="color:#fa6e32;">if </span><span style="color:#ed9366;">not </span><span style="color:#f29718;">post</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">draft</span><span style="color:#61676c;"> %}
      {
        </span><span style="color:#86b300;">&quot;title&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#f29718;">post</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">title </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">striptags </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">safe </span><span style="color:#61676c;">}}</span><span style="color:#61676ccc;">,
        </span><span style="color:#86b300;">&quot;url&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#f29718;">post</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">permalink </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">safe </span><span style="color:#61676c;">}}</span><span style="color:#61676ccc;">,
        </span><span style="color:#86b300;">&quot;body&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#f29718;">post</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">content </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">striptags </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">safe </span><span style="color:#61676c;">}}
      }
      {% </span><span style="color:#fa6e32;">if </span><span style="color:#ed9366;">not </span><span style="color:#f29718;">loop</span><span style="color:#ed9366;">.</span><span style="color:#fa6e32;">last</span><span style="color:#61676c;"> %}</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">{% </span><span style="color:#f29718;">endif</span><span style="color:#61676c;"> %}
    {% </span><span style="color:#f29718;">endif</span><span style="color:#61676c;"> %}
  {%</span><span style="color:#ed9366;">- </span><span style="color:#f29718;">endfor </span><span style="color:#ed9366;">-</span><span style="color:#61676c;">%}
]
</span></pre>
<p>I'm pretty sure that the Jekyll version looks quite similar.
<a href="https://learn.cloudcannon.com/jekyll/output-json/">Here's a starting point</a>.</p>
<h2 id="observations">Observations</h2>
<ul>
<li>This is still the wild west: unstable features, nightly Rust, documentation
gets outdated almost every day.<br />
Bring your thinking cap!</li>
<li>Creating a product out of a good idea is a lot of work. One has to pay
attention to many factors: ease-of-use, generality, maintainability,
documentation and so on.</li>
<li>Rust is very good at removing dead code, so you usually don't pay for what
you don't use. I would still advise you to be very conservative about the
dependencies you add to a Wasm binary because it's tempting to add features
that you don't need and which will add to the binary size. For example, I
used Structopt during testing, and I had a <code>main()</code> function that was parsing
these command-line arguments. This was not necessary for Wasm, so I
removed it later.</li>
<li>I understand that not everyone wants to write Rust code. It's complicated to
get started with, but the cool thing is that you can do the same thing with
almost any other language, too. For example, you can write Go code and
transpile to Wasm, or maybe you prefer PHP or Haskell. There is support for
<a href="https://github.com/appcypher/awesome-wasm-langs">many languages</a> already.</li>
<li>A lot of people dismiss WebAssembly as a toy technology. They couldn't be
further from the truth. In my opinion, WebAssembly will revolutionize the way we build
products for the web and beyond. What was very hard just two years ago is now
easy: shipping code in any language to every browser. I'm super excited about
its future.</li>
<li>If you're looking for a standalone, self-hosted search index for your company
website, check out <a href="https://journal.valeriansaliou.name/announcing-sonic-a-super-light-alternative-to-elasticsearch/">sonic</a>.</li>
</ul>
<h2 id="try-it">Try it!</h2>
<p>The code for <a href="https://github.com/mre/tinysearch">tinysearch is on Github</a>.</p>
<p>Please be aware of these limitations:</p>
<ul>
<li><strong>Only searches for entire words.</strong> There are no search suggestions.</li>
<li>Since we bundle all search indices for all articles into one static binary, I
<strong>only recommend to use it for low- to medium-size websites</strong>. Expect around 4kB
(non-compressed) per article.</li>
<li><strike>The <strong>compile times are abysmal</strong> at the moment (around 1.5 minutes after a
fresh install on my machine), mainly because we're compiling the Rust crate
from scratch every time we rebuild the index.</strike><br />
Update: This is mostly fixed by now thanks to the awesome work of
<a href="https://github.com/CephalonRho">CephalonRho</a> in PR
<a href="https://github.com/mre/tinysearch/pull/13">#13</a>. Thanks again!</li>
</ul>
<p>The final Wasm code is laser-fast because we save the roundtrips to a
search-server. The instant feedback loop feels more like filtering a list than
searching through files.</p>
<h2 id="credits">Credits</h2>
<p>Thanks to <a href="https://github.com/jorgelbg/">Jorge Luis Betancourt</a>,
<a href="https://github.com/mh84">mh84</a>, and <a href="https://github.com/schalkneethling">Schalk
Neethling</a> for their code contributions and
to <a href="https://github.com/ebarriosjr">Esteban Barrios</a>, <a href="https://github.com/m3t0r">Simon Br√ºggen</a> and <a href="https://github.com/pizzamig">Luca
Pizzamiglio</a> for reviewing drafts of this article.</p>


  <ul class='post-links'>
    <li>
    üí°Found an error? Please <a href="https://github.com/mre/mre.github.io/edit/source/content/2019&#x2F;tinysearch&#x2F;index.md">propose a change</a> on Github.
    </li>
    
    <li>
      
üí¨ Comments on

<a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;rust&#x2F;comments&#x2F;dl1sw2&#x2F;a_tiny_static_fulltext_search_engine_using_rust&#x2F;">Reddit</a>.


    </li>
    
    
  </ul>
</article>

      </main>
      <img
        alt="Page view statistics"
        style="display:none"
        src="https://ping.endler.dev/x.gif"
      />
    </div>
    

<section id="teaser">
    <div class="body">
        <h2><a href="https:&#x2F;&#x2F;endler.dev&#x2F;2019&#x2F;maybe-you-dont-need-kubernetes&#x2F;">Maybe You Don&#x27;t Need Kubernetes</a></h2>
        <p>
        
    
        A woman riding a scooter
        
        Illustration created by freepik, Nomad logo by HashiCorp.
    

Kubernetes is the 800-pound gorilla of container orchestration.
It powers some of the biggest deployments worldwide, but it comes
with a price tag.
Especially for smaller ‚Ä¶ <a
                href="https:&#x2F;&#x2F;endler.dev&#x2F;2019&#x2F;maybe-you-dont-need-kubernetes&#x2F;">Continue
                reading</a></p>
    </div>
</section>

 <footer>
    <div class="body">
        <div>
            <h2><a href="/about">About me</a></h2>
            <p>
                I'm a Backend Engineer running <i><a href="http://hello-rust.show/">Hello, Rust!</a></i>, a YouTube
                channel about the Rust
                programming language.
                On this blog, you'll mostly find articles about programming in
                <a href="/2017/yes/">Rust</a> and <a href="/2018/go-io-testing/">Golang</a> or developer tools like <a
                    href="/2017/makefiles/">make</a> and <a href="/2018/ten-years-of-vim/">Vim</a>. We should hang out
                some
                time.
                It'll be great.<br />
            </p>
        </div>


        <div>
            <h2><a href="https://github.com/sponsors/mre/">Support</a></h2>
            <p>
                Creating and maintaining this blog and my projects is a lot of
                work. By supporting me, you allow me to invest more time in new
                content, new features, and continuous maintenance. The best way
                to support me is to <a href="https://github.com/sponsors/mre/">sponsor me on GitHub</a>.
                GitHub will even match sponsorships until October 2020!
                Alternatively, I also have <a
                href="https://www.patreon.com/hellorust">Patreon</a> account. Thank you! ‚ù§Ô∏è
            </p>
        </div>


        <div>
            <form action="https://tinyletter.com/mre" method="post" target="popupwindow"
                onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600'); return true">
                <p><label for="tlemail">Wow! I also have a newsletter for new articles:</label></p>
                <p>
                    <input class="field email" type="email" name="email" id="tlemail" placeholder="E-Mail Address" />
                    <input type="hidden" value="1" name="embed" /><input class="field submit" type="submit"
                        value="Subscribe" />
                </p>
            </form>
            <p>
                <a href="https://twitter.com/matthiasendler">Twitter</a> is also fine.
            </p>
        </div>
    </div>
</footer> 
  </body>
</html>
