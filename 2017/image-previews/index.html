<!DOCTYPE html>
<html lang="en">
  <head>
    
    <style>
      html,body,div,form,fieldset,legend,label,h1,h2{margin:0;padding:0}html,body{height:100%}body{font-family:Georgia, Times, serif;font-size:120%;line-height:1.58;border-top:0.5em solid #c35}.container{display:flex;flex-direction:column;margin:0px auto;margin-top:10px}header{font-size:0.8em;text-align:center}.bio{width:210px;margin:auto;padding:16px}main{padding:20px;margin-bottom:50px;max-width:650px}figure a{border:none}figure a:hover{border:none}nav a,nav a:hover{border-bottom:none}main article{margin-bottom:44px}main img{max-width:100%}main video{max-width:100%}.homepage h1{font-size:130%}@media screen and (max-width: 640px){body{font-size:110%}}@media screen and (min-width: 800px){.container{flex-direction:row;justify-content:center;margin-top:70px}main{padding:0px 30px}.bio span:after{content:"Writes about Rust, low-level computing, and microwave clocks."}}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:400}.post-meta{font-style:italic;margin:0px;font-size:90%}.homepage .post-meta{font-size:80%}.post-links{list-style:none;padding:24px 0 0 0;margin-top:40px;border-top:solid 1px #555}code{background:#fafafa;border-radius:6px;display:inline-block;font-family:"Courier New", "Courier", monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,0.125)}blockquote{border-left:4px solid #9fd6fa;font-style:italic;margin:4px 10px;padding:3px 20px}pre{padding:10px;border-radius:6px;overflow-x:auto;box-shadow:0 1px 1px rgba(0,0,0,0.125)}h1{font-size:1.87em;margin-bottom:8px}h2{font-size:1.2em}h3{margin-top:0px;font-style:italic}::selection{background:black;color:white}a{color:#c35;text-decoration:none;border-bottom:1px dashed #c35}a:hover{border-bottom:2px solid #c35}header nav ul{display:inline-block;padding-left:0px;margin-top:0}header nav li{list-style:none;display:inline}.icon{height:24px;width:24px;opacity:0.4;float:left;margin:5px;background-repeat:no-repeat}.icon:hover{opacity:1;transition:opacity 200ms ease-in}.button{background-color:#c35;padding:10px;color:white}figure{font-size:0.9em;font-style:italic;margin:40px 0 40px;padding:0;text-align:center;text-indent:0}figure img{width:100%}figcaption{margin-top:10px}.comments{list-style:none;display:inline}#teaser{background:#c35;color:#f5b2c8}#teaser a,footer a{color:white;border-bottom:2px solid #c35}#teaser a::after{content:"\a0Â»"}footer{background:#234;color:#b9b9b9}#teaser,footer{display:flex;justify-content:center}#teaser .body,footer .body{max-width:800px;margin:40px auto;padding:20px}.email{background-color:white}.submit{background-color:#b9b9b9}footer .field{padding:10px;font-size:0.8em;border:none}.autocomplete{position:relative;display:inline-block}.autocomplete input{border:1px solid #ddd;padding:10px 20px;border-radius:20px;width:150px;font-size:0.9em;box-shadow:0 1px 0px rgba(255,255,255,0.25)}input[type="submit"]{cursor:pointer}input:focus::placeholder{color:transparent}.autocomplete-items{position:absolute;left:0;top:38px;font-size:0.9em;line-height:1.5;width:100%}.autocomplete-items div{padding:10px;cursor:pointer;background-color:white;border:1px solid #ddd}.autocomplete-items div:hover,.autocomplete-active{background-color:#c35 !important;color:white}@media not screen and (max-width: 800px){.searchicon{display:none}}@media screen and (max-width: 800px){#searchbox{display:none}#searchbox:target{display:block}.autocomplete{width:100%;font-size:1.1em}.autocomplete input{width:calc(100% - 100px);margin:20px 10px}.autocomplete-items{top:58px}}.info{padding:20px;margin:30px 0;background-color:lightyellow;border:4px solid peachpuff;position:relative;border-radius:6px}.logo_font{position:relative;width:175px;height:34px;margin:0 auto}.logo_font svg{position:absolute;top:0;left:0}@media (prefers-color-scheme: light){.logo_font_dark{display:none}}@media (prefers-color-scheme: dark){.logo_font_light{display:none}}@media (prefers-color-scheme: dark){body{background:#234;color:white;border-top:0.5em solid #ff1c76}.bio,.post-meta{color:#b9b9b9}.post-links{border-top:solid 1px white}a{color:#ff1c76;border-bottom:1px dashed #ff1c76}a:hover{border-bottom:2px solid #ff1c76}.icon{filter:brightness(0) invert(1)}main img{background-color:white;border-radius:6px}code{background-color:#111}pre{background-color:#fff;-webkit-filter:invert(100%);filter:invert(100%)}.info{background:#141f2b;border-color:#555}.autocomplete input,.autocomplete-items div{border:0;background:#141f2b;color:white}footer{background:#141f2b}}

    </style>
<title>Lightning Fast Image Previews with Pure CSS and LQIP | Matthias Endler</title>
<link rel="canonical" href="https://endler.dev/2017/image-previews/">



<meta property="og:title" content="Lightning Fast Image Previews with Pure CSS and LQIP | Matthias Endler" />
<meta property="og:type" content="website" />
<meta property="og:description" content="My website is reasonably fast. There was one thing left which really annoyed me: layout reflow after images got loaded. The problem is, that the image dimensions are not known when the text is ready to be displayed. As a result, the text will be pushed down on the screen as soon as an image is loaded above. I decided to fix that once and for all." />
<meta property="og:url" content="https://endler.dev/2017/image-previews/" />
<meta property="og:image" content="https://endler.dev/2017/image-previews/2017_image_previews.png" />

<meta name="twitter:title" content="Lightning Fast Image Previews with Pure CSS and LQIP">
<meta name="twitter:description" content="My website is reasonably fast. There was one thing left which really annoyed me: layout reflow after images got loaded. The problem is, that the image dimensions are not known when the text is ready to be displayed. As a result, the text will be pushed down on the screen as soon as an image is loaded above. I decided to fix that once and for all.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://endler.dev/2017/image-previews/2017_image_previews.png">
    <link rel="canonical" href="https://endler.dev/2017/image-previews/" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x32.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x16.png?v=m2llJQPQq8"
    />
    <link
      rel="mask-icon"
      href="/safari-pinned-tab.svg?v=m2llJQPQq8"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="author" content="Matthias Endler" />
    <meta
      name="description"
      content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and Backend development. Rust, Go"
    />
  </head>

  <body>
    <div class="container">
      <header>
        



<a href="/" aria-label="Go back to homepage">
  <div style="width: 110px; margin: auto;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456 456"><defs/><g letter-spacing="0" transform="translate(-167)" word-spacing="0"><circle cx="395" cy="228" r="220" fill="#fff" stroke="#000" stroke-width="16"/><path fill="#856800" fill-rule="evenodd" d="M468 266l-70 37-77-37z"/><path fill="#ffcb15" fill-rule="evenodd" d="M468 266l-70 31-77-31z"/><path d="M360 208a22 21 85 00-2 0 22 21 85 00-19 24 22 21 85 0023 19 22 21 85 0019-23 22 21 85 00-7-14 5 6 0 012 4 5 6 0 01-6 7 5 6 0 01-5-7 5 6 0 016-6 5 6 0 013 1 22 21 85 00-14-5zm71 1a22 21 85 00-2 0 22 21 85 00-19 23 22 21 85 0022 20 22 21 85 0019-24 22 21 85 00-20-19zm10 4a5 6 0 015 6 5 6 0 01-5 6 5 6 0 01-5-6 5 6 0 015-6z"/></g><path fill-rule="evenodd" d="M262 58c-4 9-12 19-19 24 1-8 2-16 1-22-4 8-12 18-20 24 2-7 2-15 1-21-7 13-15 24-29 28-70 20-131 113-152 213 11 28 29 53 51 73 8-158 45-267 112-208 10 9 16 13 20 13 5 0 10-4 21-13 67-59 105 50 112 208 22-20 40-45 51-73-20-95-77-184-144-209l-10-4c4-8 7-23 5-33z"/></svg>
  </div>
  <div class="logo_font">
    <div class="logo_font_dark">
    <svg xmlns="http://www.w3.org/2000/svg" class="logo_font_dark" viewBox="0 0 786.1 139.2"><defs/><path fill="#fff" d="M734.2.1v139h12V73.3l7.3-.3 19.2 66.2 13.4-.1L765 69.4c7.8-4.8 14.7-12 14.4-35.5C779.1 10.2 764.9.2 749.2.1zm-200 .5l-11.4.1v138h11.4v-101l28.3 101v.4h11.3V1.1h-11.2v51.8l-.1-.1V102L534.2 1V.8zm116 0v138h31.6v-10.7l-20.2.1V0h-11.4zm-171 .1v138h31.7V128h-20.2V72.3h18.8V61.7h-18.8V11.1h20.2V.4h-31.7zm109 0v138h13.9c14.8 0 24.7-7.5 29.5-22.5 2.8-8.9 4.2-24.4 4.2-46.7 0-22.2-1.4-37.8-4.2-46.6C626.8 7.9 616.9.4 602.1.4h-13.9zm103 0v138h31.7V128h-20.4V72.3h19V61.7h-19V11.1h20.3V.4h-31.6zm54 9.8c16.5 0 20.6 7.9 20.6 23.3 0 15.5-1 28-20.6 28zm-146 .9h1.2c10.5 0 17.4 6.2 20.6 18.5a176 176 0 013.1 40c0 19.2-1 32.5-3.1 39.9-3.2 12.3-10 18.5-20.6 18.5h-1.2v-117z" color="#000" style="font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;text-orientation:mixed;white-space:normal;shape-padding:0;isolation:auto;mix-blend-mode:normal"/><path fill="#9f9f9f" d="M406.2.1a23.8 23.8 0 00-11.3 3.3 22.4 22.4 0 00-9 12.2 42 42 0 00.7 30.2 68.6 68.6 0 0011.7 18.4 2360 2360 0 019.4 11c10.6 12.3 14.7 23 13.3 34.8-1.1 8.5-4.2 14-9.7 17.3-4.1 2.4-10.3 2-15.3.2a44.7 44.7 0 01-10.9-9l-5.3 7.4a15 15 0 002.5 3.6c2.8 3.2 8 6.9 11.8 8.2l.2.3a52.7 52.7 0 0020 0c9-3.5 14.6-11.7 16.2-24 1-6.6 1-11 0-16.6-1.9-12.4-5.8-19.5-18.8-34.7-13.5-15.5-16.9-21.1-18-29.5-1.3-9.7 1.9-18 7.9-21.4 4.4-2.3 8.5-1.3 12.9.7a28 28 0 014.4 3.2l1.6 1.3c.6 0 3.9-8 4.4-8.8A23.8 23.8 0 00406.2.1zm-302 .2l-20.9 138h11.4l6-45.8H120l6 45.8h11.4L116.5.3zm78 0h-39.4v10.8h14.8v128H169v-128h28.1v128h11.4v-128h14.9V.3zm46.3 0v138H240V72h28.4v66.4h11.2V.4L268.3.3v61.5h-28.4V.3zm66.1 0v138H306V.3zm47.4 0l-21 138h11.4l5.9-45.8h19.4l5.9 45.9H375L354.2.4H342zM0 .7v138h11.4v-117c6.6 12.7 13.8 26 19.7 36.8l5.7 10 5.7-10 19.7-36.6v117h11.2V.9H62.2L40.7 40.7l-4 7.4c-9-17-17.3-32-25.4-47.2L0 .8zm110 18.7l8.5 64.3h-17zm238 0l8.4 64.4h-16.9l8.5-64.3z"/></svg>
    </div>
    <div class="logo_font_light">
    <svg xmlns="http://www.w3.org/2000/svg" class="logo_font_light" viewBox="0 0 786.1 139.2"><defs/><path fill="#030303" style="font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;text-orientation:mixed;white-space:normal;shape-padding:0;isolation:auto;mix-blend-mode:normal" d="M734.2.1v139h12V73.3l7.3-.3 19.2 66.2 13.4-.1L765 69.4c7.8-4.8 14.7-12 14.4-35.5C779.1 10.2 764.9.2 749.2.1zm-200 .5l-11.4.1v138h11.4v-101l28.3 101v.4h11.3V1.1h-11.2v51.8l-.1-.1V102L534.2 1V.8zm116 0v138h31.6v-10.7l-20.2.1V0h-11.4zm-171 .1v138h31.7V128h-20.2V72.3h18.8V61.7h-18.8V11.1h20.2V.4h-31.7zm109 0v138h13.9c14.8 0 24.7-7.5 29.5-22.5 2.8-8.9 4.2-24.4 4.2-46.7 0-22.2-1.4-37.8-4.2-46.6C626.8 7.9 616.9.4 602.1.4h-13.9zm103 0v138h31.7V128h-20.4V72.3h19V61.7h-19V11.1h20.3V.4h-31.6zm54 9.8c16.5 0 20.6 7.9 20.6 23.3 0 15.5-1 28-20.6 28zm-146 .9h1.2c10.5 0 17.4 6.2 20.6 18.5a176 176 0 013.1 40c0 19.2-1 32.5-3.1 39.9-3.2 12.3-10 18.5-20.6 18.5h-1.2v-117z" color="#000"/><path fill="#9f9f9f" d="M406.2.1a23.8 23.8 0 00-11.3 3.3 22.4 22.4 0 00-9 12.2 42 42 0 00.7 30.2 68.6 68.6 0 0011.7 18.4 2360 2360 0 019.4 11c10.6 12.3 14.7 23 13.3 34.8-1.1 8.5-4.2 14-9.7 17.3-4.1 2.4-10.3 2-15.3.2a44.7 44.7 0 01-10.9-9l-5.3 7.4a15 15 0 002.5 3.6c2.8 3.2 8 6.9 11.8 8.2l.2.3a52.7 52.7 0 0020 0c9-3.5 14.6-11.7 16.2-24 1-6.6 1-11 0-16.6-1.9-12.4-5.8-19.5-18.8-34.7-13.5-15.5-16.9-21.1-18-29.5-1.3-9.7 1.9-18 7.9-21.4 4.4-2.3 8.5-1.3 12.9.7a28 28 0 014.4 3.2l1.6 1.3c.6 0 3.9-8 4.4-8.8A23.8 23.8 0 00406.2.1zm-302 .2l-20.9 138h11.4l6-45.8H120l6 45.8h11.4L116.5.3zm78 0h-39.4v10.8h14.8v128H169v-128h28.1v128h11.4v-128h14.9V.3zm46.3 0v138H240V72h28.4v66.4h11.2V.4L268.3.3v61.5h-28.4V.3zm66.1 0v138H306V.3zm47.4 0l-21 138h11.4l5.9-45.8h19.4l5.9 45.9H375L354.2.4H342zM0 .7v138h11.4v-117c6.6 12.7 13.8 26 19.7 36.8l5.7 10 5.7-10 19.7-36.6v117h11.2V.9H62.2L40.7 40.7l-4 7.4c-9-17-17.3-32-25.4-47.2L0 .8zm110 18.7l8.5 64.3h-17zm238 0l8.4 64.4h-16.9l8.5-64.3z"/></svg>
    </div>
  </div>
</a>

        <p class="bio">
          <span>
            Backend engineer at trivago, open-source maintainer, speaker.
          </span>
          <a href="/about">About me.</a>
        </p>
        





<nav>
    <ul>
        <li>
            <a class="icon" href="/" title="Go to homepage" aria-label="Go to homepage">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 61 58'><path stroke='#fff' stroke-linecap='square' stroke-width='.52916' d='M7 21v36h16V38h15v19h15V21z'/><path d='M61 26H0l15-13L30 0l15 13z'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://github.com/mre" title="My Github profile" aria-label="My Github profile">
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 578.3 578.3'><path d='M533 160c1-26-5-53-10-79-1-9-5-18-8-27-2-6-10-10-16-9l-12 3c-39 13-76 32-111 54-5 3-11 4-17 3l-41-5c-33-1-67 0-100 6-5 1-11 0-15-3-38-24-77-46-122-57-7-2-14-1-15 1l-3 6c-5 16-10 33-13 51-4 20-7 42-5 62 1 13-3 21-10 30-24 31-34 66-35 104-1 33 4 65 14 97 15 48 45 84 90 108 36 19 76 27 117 28h111c37 1 73-3 109-14 35-12 66-30 90-60 34-42 45-92 47-145 2-40-6-78-30-111a65 65 0 01-15-43zm-71 310c-16 13-35 20-55 25-39 9-79 11-119 10-39 1-78-1-116-10-28-7-54-18-72-42-29-39-36-112 11-152 12-11 26-17 41-18l53-3 133 3c20 0 40-5 60-4 18 2 38 5 54 12 28 12 42 37 47 66 7 43-2 83-37 113z'/><ellipse cx='390' cy='385.6' rx='42.1' ry='56.3'/><ellipse cx='189' cy='385.6' rx='42.1' ry='56.3'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://twitter.com/matthiasendler" title="My Twitter profile"
                aria-label="My Twitter profile">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 612 612'><path fill='#010002' d='M612 116c-23 10-47 17-72 20 26-15 46-40 55-69-24 14-51 24-80 30a125 125 0 0 0-217 86c0 10 1 19 3 29-104-6-196-56-258-132a125 125 0 0 0 39 168c-21-1-40-6-57-16v2c0 61 43 111 100 123a127 127 0 0 1-56 2c16 50 62 86 117 87A252 252 0 0 1 0 498a355 355 0 0 0 550-301l-1-16c25-17 46-40 63-65z'/></svg> 
            </a>
        </li>
        <li>
            <a class="icon" href="https://feedly.com/i/subscription/feed/https%3A%2F%2Fendler.dev%2Frss.xml" title="My RSS feed"
                aria-label="My RSS feed"><svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 1280 1280'><path d='M264 224l-1 79v79h8a660 660 0 0 1 438 174 665 665 0 0 1 218 492h156l1-26a820 820 0 0 0-715-792c-37-5-103-9-105-6z'/><path d='M263 504l-1 78 1 79 14 2a383 383 0 0 1 369 368l1 17h158v-19a536 536 0 0 0-98-293 546 546 0 0 0-444-232zM353 830a110 110 0 0 0-77 160 110 110 0 1 0 188-114c-5-7-23-25-30-29-25-16-54-22-81-17z'/></svg></a>
        </li>
        <li>
            <a class="searchicon icon" href="#searchbox" title="Search"
                aria-label="Search through articles">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90.1 90.1"><defs/><path d="M71.8 62.6a39.6 39.6 0 10-9.2 9.2L79 88.2a6.5 6.5 0 009.2-9.2zM13 39.6a26.5 26.5 0 1126.5 26.5 26.5 26.5 0 01-26.5-26.5z"/></svg>
            </a>
        </li>
    </ul>
</nav> 
<script defer type="module">async function lazyLoad(){await init("/tinysearch_engine_bg.wasm")}var loaded=!1;function autocomplete(e){var t;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),t>=e.length&&(t=0),t<0&&(t=e.length-1),e[t].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("click",(function(e){loaded||(lazyLoad(),loaded=!0)})),e.addEventListener("input",(function(e){var n,o,i,c=this.value;if(a(),!c)return!1;t=-1,(n=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(n);let r=search(c,3);for(i=0;i<r.length;i++){let e=r[i];(o=document.createElement("DIV")).innerHTML=e[0],o.addEventListener("click",(function(t){window.location.href=`${e[1]}?q=${encodeURIComponent(c)}`})),n.appendChild(o)}})),e.addEventListener("keydown",(function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(t++,n(a)):38==e.keyCode?(t--,n(a)):13==e.keyCode&&(e.preventDefault(),t>-1&&a&&a[t].click())})),document.addEventListener("click",(function(e){a(e.target)}))}let wasm;autocomplete(document.getElementById("tinysearch"));let WASM_VECTOR_LEN=0,cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const n=cachedTextEncoder.encode(e);return t.set(n),{read:e.length,written:n.length}};let cachegetUint8Memory=null;function getUint8Memory(){return null!==cachegetUint8Memory&&cachegetUint8Memory.buffer===wasm.memory.buffer||(cachegetUint8Memory=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory}function passStringToWasm(e){let t=e.length,n=wasm.__wbindgen_malloc(t);const a=getUint8Memory();let o=0;for(;o<t;o++){const t=e.charCodeAt(o);if(t>127)break;a[n+o]=t}if(o!==t){0!==o&&(e=e.slice(o)),n=wasm.__wbindgen_realloc(n,t,t=o+3*e.length);const a=getUint8Memory().subarray(n+o,n+t);o+=encodeString(e,a).written}return WASM_VECTOR_LEN=o,n}const heap=new Array(32);function getObject(e){return heap[e]}heap.fill(void 0),heap.push(void 0,null,!0,!1);let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}export function search(e,t){return takeObject(wasm.search(passStringToWasm(e),WASM_VECTOR_LEN,t))}let cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function getStringFromWasm(e,t){return cachedTextDecoder.decode(getUint8Memory().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;return heap_next=heap[t],heap[t]=e,t}function init(e){let t;void 0===e&&(e=import.meta.url.replace(/\.js$/,"_bg.wasm"));const n={wbg:{}};if(n.wbg.__wbindgen_json_parse=function(e,t){return addHeapObject(JSON.parse(getStringFromWasm(e,t)))},"function"==typeof URL&&e instanceof URL||"string"==typeof e||"function"==typeof Request&&e instanceof Request){const a=fetch(e);t="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,n).catch(e=>a.then(t=>{if("application/wasm"!=t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),t.arrayBuffer();throw e}).then(e=>WebAssembly.instantiate(e,n))):a.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))}else t=WebAssembly.instantiate(e,n).then(t=>t instanceof WebAssembly.Instance?{instance:t,module:e}:t);return t.then(({instance:e,module:t})=>(wasm=e.exports,init.__wbindgen_wasm_module=t,wasm))}export default init;</script>
<form id="searchbox" autocomplete="off">
    <div class="autocomplete">
        <input id="tinysearch" type="text" aria-label="Search through articles" placeholder="&#x1F50D; Search">
        </label>
    </div>
</form>
      </header>

      <main>
        
<article>
  <p class='post-meta'>Published on 




18th of September, 2017
</p>
  <h1>Lightning Fast Image Previews with Pure CSS and LQIP</h1>
  
  <figure>
        <img src=".&#x2F;factory.svg"  />
    <figcaption>
        <br />
        Adapted from <a href="http://www.freepik.com/free-vector/industrial-machine-vector_753558.htm">Freepik</a>
    </figcaption>
</figure>
<p>My website is reasonably fast.</p>
<p>I hope that every page load feels snappy, no matter your device or location.
That should not come as a surprise. After all, I'm just using plain HTML and CSS.
JavaScript is avoided whenever possible.</p>
<p>There was one thing left, which really annoyed me: layout reflow after images got loaded.</p>
<p>The problem is, that the image dimensions are not known when the text is ready to be displayed.
As a result, the text will be pushed down on the screen as soon as an image is loaded above.</p>
<p>Also, while an image is loading, there is no preview, just blank space.
Here's what that looks like on a slower connection:</p>
<p><img src="./fout.png" alt="Illustration of a flash of unstyled content" /></p>
<p>I could fix that, by hardcoding the image width and height, but that would be tedious and error-prone.
And there would be no preview.
So I was wondering, what others were doing. ð¤</p>
<h2 id="tiny-image-thumbnails">Tiny image thumbnails</h2>
<p>I vaguely remembered, that <a href="https://code.facebook.com/posts/991252547593574/the-technology-behind-preview-photos/">Facebook uses tiny preview thumbnails in their mobile app</a>.
They extract the quantization table from the JPEG header to render the preview. This information 
is stored on the client, so it doesn't need to be downloaded every time.
Unfortunately, this approach requires full control over the image encoder.
It works for apps, but hardly for websites.</p>
<p>The search continued.</p>
<p>Until my colleague <a href="http://tobias.is/">Tobias Baldauf</a> introduced me to <a href="https://www.guypo.com/introducing-lqip-low-quality-image-placeholders">LQIP (Low-Quality Image Placeholders)</a>.</p>
<p>Here's the idea:</p>
<ul>
<li>Load the page including inlined, low-quality image thumbnails.</li>
<li>Once the page is fully loaded (e.g. when the <a href="https://www.w3schools.com/jsref/event_onload.asp"><code>onload</code> event</a> is fired), lazy load full quality images.</li>
</ul>
<p>Unfortunately, this technique requires JavaScript.
Nevertheless, I liked the idea, so I started experimenting with different image sizes and formats. My goal was to create the smallest thumbnails using any standard image format.</p>
<h2 id="benchmark">Benchmark</h2>
<p>Here are 15 pixel wide thumbnails encoded in different file formats:</p>
<p><img src="./thumbnails.jpg" alt="Comparison of different image formats when creating thumbnails" /></p>
<p>I used different tools to create the thumbnails.
For JPEG and PNG encoding, I used <a href="https://github.com/shakiba/svgexport">svgexport</a>.</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">svgexport</span><span style="color:#61676c;"> img.svg img.png </span><span style="color:#86b300;">&quot;svg{background:white;}&quot;</span><span style="color:#61676c;"> 15: 1%
</span></pre>
<p>For webp, I used <a href="https://developers.google.com/speed/webp/docs/cwebp">cwebp</a>:</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">cwebp</span><span style="color:#61676c;"> img.png</span><span style="color:#ff8f40;"> -o</span><span style="color:#61676c;"> img.webp
</span></pre>
<p>The gif was converted using an online tool and optimized using <a href="https://github.com/kohler/gifsicle">gifsicle</a>:</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">gifsicle</span><span style="color:#ff8f40;"> -O3 </span><span style="color:#ed9366;">&lt;</span><span style="color:#61676c;"> img.gif </span><span style="color:#ed9366;">&gt;</span><span style="color:#61676c;"> img_mini.gif
</span></pre><h2 id="comparison">Comparison</h2>
<p>WebP is the smallest, but it's <a href="http://caniuse.com/#feat=webp">not supported by all browsers</a>.<br />
Gif was second, but when resizing the image and applying the blur filter, I was not happy with the result.<br />
In the end, I settled for PNG, which provided an excellent tradeoff between size and quality.
I optimized the images even further using <a href="https://github.com/shssoichiro/oxipng">oxipng</a>, which supports zopfli compression.
With that, I end up with thumbnails of around 300-400 bytes in size.</p>
<p>I integrated the thumbnail creation process into my build toolchain for the blog.
The actual code to create the images is rather boring.
If you <em>really</em> want to have a look, <a href="https://github.com/mre/lqip/">it's on Github</a>.</p>
<h2 id="avoiding-javascript">Avoiding JavaScript</h2>
<p>Here is the skeleton HTML for the image previews:</p>
<pre style="background-color:#fafafa;">
<span style="color:#55b4d490;">&lt;</span><span style="color:#399ee6;">figure</span><span style="color:#55b4d490;">&gt;
  &lt;</span><span style="color:#399ee6;">div </span><span style="color:#f29718;">class</span><span style="color:#61676ccc;">=</span><span style="color:#86b300;">&quot;loader&quot;</span><span style="color:#55b4d490;">&gt;
    &lt;</span><span style="color:#399ee6;">object </span><span style="color:#f29718;">data</span><span style="color:#61676ccc;">=</span><span style="color:#86b300;">&quot;image.svg&quot; </span><span style="color:#f29718;">type</span><span style="color:#61676ccc;">=</span><span style="color:#86b300;">&quot;image/svg+xml&quot;</span><span style="color:#55b4d490;">&gt;&lt;/</span><span style="color:#399ee6;">object</span><span style="color:#55b4d490;">&gt;
    &lt;</span><span style="color:#399ee6;">img </span><span style="color:#f29718;">class</span><span style="color:#61676ccc;">=</span><span style="color:#86b300;">&quot;frozen&quot; </span><span style="color:#f29718;">src</span><span style="color:#61676ccc;">=</span><span style="color:#86b300;">&quot;data:image/png;base64,...&quot;</span><span style="color:#55b4d490;"> /&gt;
  &lt;/</span><span style="color:#399ee6;">div</span><span style="color:#55b4d490;">&gt;
&lt;/</span><span style="color:#399ee6;">figure</span><span style="color:#55b4d490;">&gt;
</span></pre>
<p>The trick is to wrap both the full-size image and the preview image into a <code>loader</code> div,
which gets a <code>width: auto</code> CSS attribute:</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">.loader </span><span style="color:#61676c;">{
  </span><span style="color:#55b4d4;">position</span><span style="color:#61676ccc;">:</span><span style="font-style:italic;color:#ed9366;">relative</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">overflow</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">hidden</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">width</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">auto</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}
</span></pre>
<p>I wrap the SVG into an <code>object</code> tag instead of using an <code>img</code> element.
This has the benefit, that I can show a placeholder in case the SVG can't be loaded.
I position the <code>object</code> at the top left of the <code>loader</code> div.</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">.loader </span><span style="color:#399ee6;">object </span><span style="color:#61676c;">{
  </span><span style="color:#55b4d4;">position</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">absolute</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}

</span><span style="color:#f29718;">.loader </span><span style="color:#399ee6;">img</span><span style="color:#61676c;">, </span><span style="color:#f29718;">.loader </span><span style="color:#399ee6;">object </span><span style="color:#61676c;">{
  </span><span style="color:#55b4d4;">display</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">block</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">top</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">left</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">width</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">100</span><span style="color:#fa6e32;">%</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}
</span></pre>
<p>Here's the placeholder <em>hack</em> including some references:</p>
<pre style="background-color:#fafafa;">
<span style="color:#61676c;">// https://stackoverflow</span><span style="color:#f29718;">.com</span><span style="color:#61676c;">/</span><span style="color:#399ee6;">a</span><span style="color:#61676c;">/29111371/270334
// https://stackoverflow</span><span style="color:#f29718;">.com</span><span style="color:#61676c;">/</span><span style="color:#399ee6;">a</span><span style="color:#61676c;">/32928240/270334
</span><span style="color:#399ee6;">object </span><span style="color:#61676c;">{
  </span><span style="color:#55b4d4;">position</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">relative</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">float</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">left</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">display</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">block</span><span style="color:#61676ccc;">;</span><span style="color:#61676c;">
  
  &amp;</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;">:after {
    position: </span><span style="font-style:italic;color:#ed9366;">absolute</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">top</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">left</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">display</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#ed9366;">block</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">width</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">1000</span><span style="color:#fa6e32;">px</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">height</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">1000</span><span style="color:#fa6e32;">px</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">content</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&#39;&#39;</span><span style="color:#61676ccc;">;
    </span><span style="color:#55b4d4;">background</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">#efefef</span><span style="color:#61676ccc;">;
  </span><span style="color:#61676c;">}
}
</span></pre>
<p>The last part is the handling of the thumbnails.
Like most other sites, I decided to apply a blur filter.
In a way, it looks like the image is <em>frozen</em>, so that's what I called the CSS selector.
I also applied a scaling transformation to achieve sharp borders.</p>
<pre style="background-color:#fafafa;">
<span style="color:#f29718;">.frozen </span><span style="color:#61676c;">{
  </span><span style="font-style:italic;color:#abb0b6;">-webkit-</span><span style="color:#55b4d4;">filter</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">blur</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">8</span><span style="color:#fa6e32;">px</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="font-style:italic;color:#abb0b6;">-moz-</span><span style="color:#55b4d4;">filter</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">blur</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">8</span><span style="color:#fa6e32;">px</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="font-style:italic;color:#abb0b6;">-o-</span><span style="color:#55b4d4;">filter</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">blur</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">8</span><span style="color:#fa6e32;">px</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="font-style:italic;color:#abb0b6;">-ms-</span><span style="color:#55b4d4;">filter</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">blur</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">8</span><span style="color:#fa6e32;">px</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">filter</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">blur</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">8</span><span style="color:#fa6e32;">px</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">transform</span><span style="color:#61676ccc;">: </span><span style="color:#f07171;">scale</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">1.04</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">animation</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">0.2</span><span style="color:#fa6e32;">s </span><span style="font-style:italic;color:#ed9366;">ease-in </span><span style="color:#ff8f40;">0.4</span><span style="color:#fa6e32;">s </span><span style="color:#ff8f40;">1 </span><span style="font-style:italic;color:#ed9366;">forwards</span><span style="color:#61676c;"> fade</span><span style="color:#61676ccc;">;
  </span><span style="color:#55b4d4;">width</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">100</span><span style="color:#fa6e32;">%</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}

</span><span style="color:#fa6e32;">@keyframes </span><span style="color:#61676c;">fade {
  </span><span style="color:#ff8f40;">0</span><span style="color:#fa6e32;">% </span><span style="color:#61676c;">{
    </span><span style="color:#55b4d4;">opacity</span><span style="color:#61676ccc;">:</span><span style="color:#ff8f40;">1</span><span style="color:#61676ccc;">;
  </span><span style="color:#61676c;">}
  </span><span style="color:#ff8f40;">100</span><span style="color:#fa6e32;">% </span><span style="color:#61676c;">{
    </span><span style="color:#55b4d4;">opacity</span><span style="color:#61676ccc;">:</span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;
  </span><span style="color:#61676c;">}
}
</span></pre>
<p>I use CSS animations instead of JavaScript.<br />
The duration of the animation is based on the 95% percentile load time of all visitors of the page. Although it's just an approximation, this should work for most readers.</p>
<h2 id="result">Result</h2>
<ul>
<li>No JavaScript needed</li>
<li>Works on all modern browsers</li>
<li>Supports a fallback in case the main image can't be loaded</li>
<li>Tiny overhead</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.guypo.com/introducing-lqip-low-quality-image-placeholders">Introducing LQIP â Low Quality Image Placeholders</a></li>
<li><a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/">How Medium does progressive image loading</a></li>
<li><a href="https://github.com/technopagan/sqip">SQIP, a new preview technique using pure SVG</a></li>
</ul>


  <ul class='post-links'>
    <li>
    ð¡Found an error? Please <a href="https://github.com/mre/mre.github.io/edit/source/content/2017&#x2F;image-previews&#x2F;index.md">propose a change</a> on Github.
    </li>
    
    
  </ul>
</article>

      </main>
      <img
        alt="Page view statistics"
        style="display:none"
        src="https://ping.endler.dev/x.gif"
      />
    </div>
    

<section id="teaser">
    <div class="body">
        <h2><a href="https:&#x2F;&#x2F;endler.dev&#x2F;2017&#x2F;go-vs-rust&#x2F;">Go vs Rust? Choose Go.</a></h2>
        <p>
        
    
        
        Gopher designed with Gopherize.me. Cogwheels designed by Freepik
    

&quot;Rust or Go, which one should I choose?&quot; is a question I get quite often.
Both languages seem to be competing for the same user base and they both seem to be
systems programming languagesâ¦ <a
                href="https:&#x2F;&#x2F;endler.dev&#x2F;2017&#x2F;go-vs-rust&#x2F;">Continue
                reading</a></p>
    </div>
</section>

 <footer>
    <div class="body">
        <div>
            <h2><a href="/about">About me</a></h2>
            <p>
                I'm a Backend Engineer running <i><a href="http://hello-rust.show/">Hello, Rust!</a></i>, a YouTube
                channel about the Rust
                programming language.
                On this blog, you'll mostly find articles about programming in
                <a href="/2017/yes/">Rust</a> and <a href="/2018/go-io-testing/">Golang</a> or developer tools like <a
                    href="/2017/makefiles/">make</a> and <a href="/2018/ten-years-of-vim/">Vim</a>. We should hang out
                some
                time.
                It'll be great.<br />
            </p>
        </div>


        <div>
            <h2><a href="https://github.com/sponsors/mre/">Support</a></h2>
            <p>
                Creating and maintaining this blog and my projects is a lot of
                work. By supporting me, you allow me to invest more time in new
                content, new features, and continuous maintenance. The best way
                to support me is to <a href="https://github.com/sponsors/mre/">sponsor me on GitHub</a>.
                GitHub will even match sponsorships until October 2020!
                Alternatively, I also have <a
                href="https://www.patreon.com/hellorust">Patreon</a> account. Thank you! â¤ï¸
            </p>
        </div>


        <div>
            <form action="https://tinyletter.com/mre" method="post" target="popupwindow"
                onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600'); return true">
                <p><label for="tlemail">Wow! I also have a newsletter for new articles:</label></p>
                <p>
                    <input class="field email" type="email" name="email" id="tlemail" placeholder="E-Mail Address" />
                    <input type="hidden" value="1" name="embed" /><input class="field submit" type="submit"
                        value="Subscribe" />
                </p>
            </form>
            <p>
                <a href="https://twitter.com/matthiasendler">Twitter</a> is also fine.
            </p>
        </div>
    </div>
</footer> 
  </body>
</html>
